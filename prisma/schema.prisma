generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
}

// ==================== CORE MODELS ====================

model Company {
  id               String         @id @default(uuid())
  name             String         @unique
  email            String?
  phone            String?
  address          String?
  logo             String?
  website          String?
  status           CompanyStatus  @default(ACTIVE)
  subscriptionId   String?        @unique
  subscription     Subscription?  @relation(fields: [subscriptionId], references: [id])
  users            User[]
  employees        Employee[]
  projects         Project[]
  procurements     Procurement[]
  invoices         Invoice[]
  expenses         Expense[]
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
}

enum CompanyStatus {
  ACTIVE
  SUSPENDED
  TRIAL
  INACTIVE
}

model Role {
  id          String       @id @default(uuid())
  name        String       @unique
  description String?
  permissions Json? // Store permissions as JSON array
  isSystem    Boolean      @default(false) // true for superadmin, admin, staff
  users       User[]
  employees   Employee[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model User {
  id          String    @id @default(uuid())
  email       String    @unique
  password    String
  firstName   String?
  lastName    String?
  avatar      String?
  phone       String?
  isActive    Boolean   @default(true)
  companyId   String?
  roleId      String
  company     Company?  @relation(fields: [companyId], references: [id])
  role        Role      @relation(fields: [roleId], references: [id])
  lastLoginAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([email])
  @@index([companyId])
}

// ==================== PRICING & SUBSCRIPTION ====================

model PricingPlan {
  id            String         @id @default(uuid())
  name          String         @unique
  description   String?
  price         Float
  billingPeriod BillingPeriod  @default(MONTHLY)
  features      Json // Store features as JSON array
  maxUsers      Int            @default(10)
  maxProjects   Int            @default(100)
  maxStorage    Int            @default(10) // in GB
  isActive      Boolean        @default(true)
  subscriptions Subscription[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

enum BillingPeriod {
  MONTHLY
  YEARLY
  LIFETIME
}

model Subscription {
  id            String             @id @default(uuid())
  planId        String
  plan          PricingPlan        @relation(fields: [planId], references: [id])
  company       Company?
  status        SubscriptionStatus @default(TRIAL)
  startDate     DateTime           @default(now())
  endDate       DateTime?
  trialEndDate  DateTime?
  autoRenew     Boolean            @default(true)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
}

enum SubscriptionStatus {
  TRIAL
  ACTIVE
  EXPIRED
  CANCELLED
}

// ==================== EMPLOYEE MANAGEMENT ====================

model Employee {
  id           String           @id @default(uuid())
  employeeCode String           @unique
  firstName    String
  lastName     String
  email        String
  phone        String?
  avatar       String?
  position     String?
  department   String?
  joinDate     DateTime         @default(now())
  salary       Float?
  status       EmployeeStatus   @default(ACTIVE)
  companyId    String
  roleId       String
  company      Company          @relation(fields: [companyId], references: [id])
  role         Role             @relation(fields: [roleId], references: [id])
  projectTasks ProjectTask[]
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  @@index([companyId])
  @@index([email])
}

enum EmployeeStatus {
  ACTIVE
  INACTIVE
  ON_LEAVE
  TERMINATED
}

// ==================== PROJECT MANAGEMENT ====================

model Project {
  id          String        @id @default(uuid())
  name        String
  code        String        @unique
  description String?
  type        ProjectType
  status      ProjectStatus @default(PLANNING)
  budget      Float?
  startDate   DateTime?
  endDate     DateTime?
  companyId   String
  company     Company       @relation(fields: [companyId], references: [id])
  tasks       ProjectTask[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([companyId])
  @@index([type])
}

enum ProjectType {
  IT_DEVELOPMENT
  PROCUREMENT
  GENERAL
}

enum ProjectStatus {
  PLANNING
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

model ProjectTask {
  id          String         @id @default(uuid())
  title       String
  description String?
  status      TaskStatus     @default(TODO)
  priority    TaskPriority   @default(MEDIUM)
  dueDate     DateTime?
  projectId   String
  assigneeId  String?
  project     Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignee    Employee?      @relation(fields: [assigneeId], references: [id])
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([projectId])
  @@index([assigneeId])
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  REVIEW
  DONE
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

// ==================== PROCUREMENT MANAGEMENT ====================

model Procurement {
  id              String            @id @default(uuid())
  procurementCode String            @unique
  title           String
  description     String?
  category        String?
  totalBudget     Float
  status          ProcurementStatus @default(DRAFT)
  requestDate     DateTime          @default(now())
  requiredDate    DateTime?
  companyId       String
  company         Company           @relation(fields: [companyId], references: [id])
  items           ProcurementItem[]
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@index([companyId])
}

enum ProcurementStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  IN_PROCESS
  COMPLETED
  CANCELLED
}

model ProcurementItem {
  id             String       @id @default(uuid())
  procurementId  String
  procurement    Procurement  @relation(fields: [procurementId], references: [id], onDelete: Cascade)
  itemName       String
  description    String?
  quantity       Int
  unit           String
  unitPrice      Float
  totalPrice     Float
  supplier       String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  @@index([procurementId])
}

// ==================== FINANCE MANAGEMENT ====================

model Invoice {
  id            String        @id @default(uuid())
  invoiceNumber String        @unique
  clientName    String
  clientEmail   String?
  description   String?
  amount        Float
  taxAmount     Float         @default(0)
  totalAmount   Float
  status        InvoiceStatus @default(DRAFT)
  issueDate     DateTime      @default(now())
  dueDate       DateTime?
  paidDate      DateTime?
  companyId     String
  company       Company       @relation(fields: [companyId], references: [id])
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@index([companyId])
  @@index([status])
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
}

model Expense {
  id          String        @id @default(uuid())
  title       String
  description String?
  category    ExpenseCategory
  amount      Float
  receipt     String?
  expenseDate DateTime      @default(now())
  companyId   String
  company     Company       @relation(fields: [companyId], references: [id])
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([companyId])
  @@index([category])
}

enum ExpenseCategory {
  SALARY
  OFFICE_SUPPLIES
  UTILITIES
  RENT
  TRAVEL
  MARKETING
  SOFTWARE
  HARDWARE
  CONSULTING
  OTHER
}
